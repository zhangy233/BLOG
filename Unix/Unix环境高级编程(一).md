
## Unix原子操作
> 在阅读Unix环境高级编程第三章时, 遇到的几个原子操作函数

### O_APPEND标志位

	在读写中经常会遇到多个线程同时往一个文件写入内容, 如果加上O_APPEND标志位, 就可以不用关注内容重叠的问题,
在早期时, 往往是使用`lseek + write`的方式, 而加入该标志位后再中间进行了一个同步操作(文件偏移量会被设置到i节点表项中的文件长度),
这个操作和写操作时一个原子操作!

### 创建一个文件
	通常使用的是`O_CREAT | O_EXCL`方式进行, 这里面就包含两步(检查文件是否存在,创建文件), 如果先调用open检测文件是否打开, 
再创建文件在涉及到多线程时很可能出现问题!


### dup2文件描述符
	对于dup2来说可以指定复制的文件描述符, 如果复制的文件描述符已经打开则先将其关闭,类似如下
```
close(fd2);
dup2(fd, F_DUPFD, fd2);
```
这是一个原子操作
ps: 对于dup操作, 会清除`FD_CLOEXEC(如果存在该标志位,在exec调用时会被关闭掉)`被清楚

> 以后感觉还会遇到这些问题, 之后再次进行记录, 2019年7月29日23点10分


